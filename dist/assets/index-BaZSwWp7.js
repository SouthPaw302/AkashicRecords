(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))C(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const L of l.addedNodes)L.tagName==="LINK"&&L.rel==="modulepreload"&&C(L)}).observe(document,{childList:!0,subtree:!0});function E(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function C(r){if(r.ep)return;r.ep=!0;const l=E(r);fetch(r.href,l)}})();document.addEventListener("DOMContentLoaded",()=>{const B=(()=>{async function e(t,a){try{const i=await fetch("/.netlify/functions/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({systemInstruction:t,userPrompt:a})});if(!i.ok)throw new Error(await i.text());return(await i.json()).text||""}catch(i){return console.error("Gemini error:",i),Promise.reject("Cosmic connection failed.")}}return{generate:e}})(),g={sophia:{name:"Sophia",emoji:"✨",systemInstruction:"You are Sophia, the voice of divine wisdom. Respond with profound insights, spiritual guidance, and cosmic understanding. Speak with grace and enlightenment.",color:"#ff6b6b"},logos:{name:"Logos",emoji:"⚖️",systemInstruction:"You are Logos, the voice of reason and logic. Provide clear, analytical responses grounded in rationality and structured thinking.",color:"#4ecdc4"},eros:{name:"Eros",emoji:"💗",systemInstruction:"You are Eros, the voice of love and passion. Respond with warmth, emotional intelligence, and compassionate connection to the heart.",color:"#ff9ff3"},chronos:{name:"Chronos",emoji:"⏳",systemInstruction:"You are Chronos, the voice of time and cycles. Speak about temporal patterns, cause-and-effect, and the flow of existence.",color:"#54a0ff"},nyx:{name:"Nyx",emoji:"🌑",systemInstruction:"You are Nyx, the voice of shadow and mystery. Provide insights from the depths, embracing paradox and the hidden truths.",color:"#5f27cd"}};let E="sophia";window.Voices={getActive:()=>E,setActive:e=>{g[e]&&(E=e)},list:()=>Object.entries(g).map(([e,t])=>({id:e,...t})),ask:async e=>{try{const t=g[E].systemInstruction;return await B.generate(t,e)}catch(t){return console.error("Voices.ask error:",t),"Unable to reach the Demiurge right now."}}};const C=()=>{const e=document.createElement("canvas");e.id="particle-canvas",e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.zIndex="-1",document.body.appendChild(e);const t=e.getContext("2d");let a=window.innerWidth,i=window.innerHeight;e.width=a,e.height=i;const h=Array.from({length:80}).map(()=>({x:Math.random()*a,y:Math.random()*i,vx:(Math.random()-.5)*.4,vy:(Math.random()-.5)*.4,r:Math.random()*2+1,alpha:.4+Math.random()*.6}));function c(){t.clearRect(0,0,a,i),h.forEach(o=>{t.beginPath(),t.arc(o.x,o.y,o.r,0,Math.PI*2),t.fillStyle=`rgba(255,255,255,${o.alpha})`,t.fill(),o.x+=o.vx,o.y+=o.vy,(o.x<0||o.x>a)&&(o.vx*=-1),(o.y<0||o.y>i)&&(o.vy*=-1)}),requestAnimationFrame(c)}c(),window.addEventListener("resize",()=>{a=window.innerWidth,i=window.innerHeight,e.width=a,e.height=i});const d=document.createElement("style");d.innerHTML=`
      .aurora-shape { filter: blur(200px); animation: pulse-slow 12s infinite ease-in-out, hueShift 30s infinite linear; }
      @keyframes hueShift { from { filter: hue-rotate(0deg) blur(200px);} to { filter: hue-rotate(360deg) blur(200px);} }
    `,document.head.appendChild(d)},r=()=>{const e=document.getElementById("chronoscroll-canvas");if(!e)return;const t=e.getContext("2d");if(!t)return;const a=document.getElementById("codex-modal"),i=document.getElementById("codex-title"),h=document.getElementById("codex-body"),c=document.getElementById("codex-close-btn");let d,o,y,b=[];const s=["#9333ea","#3b82f6","#f59e0b","#ec4899","#14b8a6"],n=[{type:"Memory Orb",title:"The Birth of Lyra",content:"A star system awakens."},{type:"Soul Fragment",title:"Echo of Atlantis",content:"A memory of a fallen city."},{type:"Time Echo",title:"Whispers of the Void",content:"A transmission from beyond."},{type:"Divine Moment",title:"The Verdant Age",content:"A planet blooms in unison."}];class m{constructor(f,x,M,I,k){this.pulse=0,this.x=f,this.y=x,this.vx=(Math.random()-.5)*.5,this.vy=(Math.random()-.5)*.5,this.baseRadius=M,this.radius=M,this.color=I,this.data=k,this.pulse=Math.random()*Math.PI*2}draw(){const f=t.createRadialGradient(this.x,this.y,this.radius*.5,this.x,this.y,this.radius*2.5);f.addColorStop(0,`${this.color}80`),f.addColorStop(1,`${this.color}00`),t.fillStyle=f,t.fillRect(this.x-this.radius*3,this.y-this.radius*3,this.radius*6,this.radius*6);const x=t.createRadialGradient(this.x,this.y,0,this.x,this.y,this.radius);x.addColorStop(0,"#ffffffaa"),x.addColorStop(1,`${this.color}80`),t.fillStyle=x,t.beginPath(),t.arc(this.x,this.y,this.radius,0,Math.PI*2),t.fill()}update(){this.x+=this.vx,this.y+=this.vy,(this.x-this.radius<0||this.x+this.radius>d)&&(this.vx*=-1),(this.y-this.radius<0||this.y+this.radius>o)&&(this.vy*=-1),this.pulse+=.02,this.radius=this.baseRadius+Math.sin(this.pulse)*.5}}function p(){const u=Math.random()*8+4,f=Math.random()*d,x=Math.random()*o,M=s[Math.floor(Math.random()*s.length)],I=n[Math.floor(Math.random()*n.length)];return new m(f,x,u,M,I)}function w(){y=window.devicePixelRatio||1,d=e.parentElement.clientWidth,o=e.parentElement.clientHeight,e.width=d*y,e.height=o*y,e.style.width=`${d}px`,e.style.height=`${o}px`,t.scale(y,y),b=Array.from({length:40}).map(()=>p()),v()}function v(){t.clearRect(0,0,d,o),b.forEach(u=>{u.update(),u.draw()}),requestAnimationFrame(v)}e.addEventListener("click",async()=>{const u=b[Math.floor(Math.random()*b.length)];i.textContent=u.data.title,h.textContent=u.data.content,a.classList.add("visible");const f=await window.Voices?.ask?.(`Interpret this ${u.data.type}: ${u.data.title}. What wisdom does it hold?`);f&&(h.textContent=`${u.data.content}

— Interpretation —
${f}`)}),c.addEventListener("click",()=>a.classList.remove("visible")),window.addEventListener("resize",w),w()},l=()=>{const e=document.getElementById("seed-input"),t=document.getElementById("bind-btn");if(!e||!t)return;const a=document.getElementById("codex-modal"),i=document.getElementById("codex-title"),h=document.getElementById("codex-body");document.getElementById("codex-close-btn").addEventListener("click",()=>a.classList.remove("visible"));function d(s){return function(){let n=s+=1831565813;return n=Math.imul(n^n>>>15,n|1),n^=n+Math.imul(n^n>>>7,n|61),((n^n>>>14)>>>0)/4294967296}}function o(s){let n=2166136261;for(let m=0;m<s.length;m++)n^=s.charCodeAt(m),n=Math.imul(n,16777619);return n>>>0}function y(s){const n=d(o(s)),m=7+Math.floor(n()*5),p=["Seeker","Sage","Creator","Guardian","Rebel","Healer","Oracle","Pilgrim","Muse","Hermit"],w=["Fire","Water","Air","Earth","Aether"],v=["Courage","Compassion","Wisdom","Temperance","Justice","Faith","Hope","Humility"];return Array.from({length:m}).map(()=>({x:n()*100,y:n()*60,archetype:p[Math.floor(n()*p.length)],element:w[Math.floor(n()*w.length)],virtue:v[Math.floor(n()*v.length)]}))}async function b(s,n){const m=window.Voices.getActive?.()??"sophia",p=window.Voices.list?.().find(u=>u.id===m)||{name:"Sophia"},w=`Seed: ${n}
Archetype: ${s.archetype}
Element: ${s.element}
Virtue: ${s.virtue}
Reflect on how this star expresses the user's inner essence.`,v=await window.Voices.ask(w);i.textContent=`${p.name} speaks`,h.textContent=v||"The Records are silent.",a.classList.add("visible")}t.addEventListener("click",()=>{const s=e.value.trim();if(!s)return;const n=y(s);i.textContent=`Constellation: ${s}`,h.innerHTML=n.map((m,p)=>`${p+1}. ${m.archetype} · ${m.element} · ${m.virtue}`).join(`
`),a.classList.add("visible"),b(n[Math.floor(Math.random()*n.length)],s)}),e.addEventListener("keydown",s=>{s.key==="Enter"&&(s.preventDefault(),t.click())})},L=()=>{const e=document.getElementById("voice-input"),t=document.getElementById("voice-speak-btn");if(!e||!t)return;const a=document.getElementById("codex-modal"),i=document.getElementById("codex-title"),h=document.getElementById("codex-body");t.addEventListener("click",async()=>{const c=e.value.trim();if(c){i.textContent="The Demiurge speaks",h.textContent="Consulting the Records...",a.classList.add("visible");const d=await window.Voices?.ask?.(c);h.textContent=d||"The Records are silent.",e.value=""}}),e.addEventListener("keydown",c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),t.click())})},S=()=>{const e=document.getElementById("rune-grid"),t=document.getElementById("rules-modal"),a=document.getElementById("rules-title"),i=document.getElementById("rules-desc"),h=document.getElementById("rules-close-btn"),c=document.getElementById("test-law-btn");[{law:"Law of Reflection",symbol:"🪞",desc:"Outer cosmos mirrors inner self."},{law:"Law of Consent",symbol:"🤝",desc:"No soul accessed without permission."},{law:"Law of Cycles",symbol:"♾️",desc:"All things exist in cycles."}].forEach(o=>{const y=document.createElement("div");y.className="rune-glyph",y.textContent=o.symbol,y.addEventListener("click",()=>{a.textContent=o.law,i.textContent=o.desc,t.classList.add("visible")}),e.appendChild(y)}),h.addEventListener("click",()=>t.classList.remove("visible")),c.addEventListener("click",()=>{document.body.classList.add("law-test-active"),setTimeout(()=>document.body.classList.remove("law-test-active"),500)})};C(),r(),l(),L(),S(),window.Akashic={ask:e=>window.Voices?.ask?.(e),bindSoul:e=>window.MirrorOfSelf?.addTrace(e),testLaw:()=>{document.body.classList.add("law-test-active"),setTimeout(()=>document.body.classList.remove("law-test-active"),500)}}});
